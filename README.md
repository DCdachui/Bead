# 🎨 拼豆转换器

将任意图片转换为拼豆图案的专业工具。支持72色标准色库，采用硬像素化算法和感知加权颜色匹配，确保输出质量。

## ✨ 功能特性

- 🖼️ **图片上传**：支持 JPG/PNG/WebP 格式
- 🤖 **AI生成**：集成Banana.dev (Nano Banana pro)，使用Google API Key生成像素图/马赛克图，自动转为拼豆图
- 🎯 **智能转换**：硬像素化算法，禁用插值，保证效果
- 🎨 **多色库支持**：24色/48色/72色/221色标准库，支持自定义JSON导入
- 📊 **色号统计**：自动统计每种颜色的用量和占比
- 🔍 **边缘增强**：可选功能，提升轮廓清晰度
- 📐 **模板生成**：生成带行列编号和颜色代码的网格模板（符合方案文档要求）
- 🖼️ **图片格式化**：解决图片宽高比不匹配问题，支持自动适配、裁剪、填充、拉伸等多种模式
- 🖨️ **高分辨率导出**：支持600DPI打印级模板导出
- 📥 **一键下载**：下载高清拼豆效果图或打印模板
- 🎨 **现代化UI**：优化的界面设计，流畅的动画效果，提升用户体验
- 📱 **响应式设计**：完美适配桌面和移动端

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

访问 http://localhost:3000

### 构建生产版本

```bash
npm run build
```

构建产物在 `dist` 目录，可直接部署到 Vercel、Netlify 等平台。

## 🛠️ 技术栈

- **Vue 3** - 渐进式前端框架
- **JavaScript** - 原生JS开发
- **Vite** - 极速构建工具
- **Canvas API** - 图像处理

## 📖 使用说明

### 方式一：上传图片转换

1. **上传图片**：点击上传区域，选择要转换的图片

### 方式二：AI生成图片（推荐）

1. **AI生成**：点击"🤖 AI生成"标签页
2. **配置API Key**：输入你的Google API Key（首次使用需要）
3. **描述图案**：输入你想要生成的图案描述（如"一只可爱的小猫"）
4. **选择风格**：
   - **拼豆风格**：专门为拼豆优化的风格（推荐）
   - **像素艺术**：8-bit像素风格
   - **马赛克**：马赛克瓷砖风格
5. **生成图片**：点击"✨ 生成图片"按钮
6. **自动转换**：AI生成的图片会自动转换为拼豆图

### 继续使用

1. **上传图片**：点击上传区域，选择要转换的图片
2. **图片格式化**（解决宽高比不匹配问题）：
   - 上传图片后会自动显示格式化选项
   - **自动适配**：保持原图比例，自动适配到目标尺寸（推荐）
   - **裁剪**：保持比例，裁剪多余部分，适合需要精确尺寸
   - **填充**：保持原图完整，添加背景色填充
   - **拉伸**：强制匹配尺寸（可能造成变形）
   - **正方形**：裁剪为正方形，适合制作方形拼豆图案
3. **调整参数**：
   - 珠子数量（宽度）：20-100格，控制图案精细度
   - 边缘增强：可选，提升轮廓清晰度
   - **模板生成**：勾选"生成模板"可生成带行列编号和颜色代码的网格模板
4. **模板参数**（启用模板生成后）：
   - 背景色代码：选择用于填充空白区域的色号（默认H2白色）
   - 模板宽度/高度：自定义模板尺寸（留空则自动计算）
5. **开始转换**：点击"开始转换"按钮
6. **查看结果**：
   - 查看拼豆效果图（圆形珠子预览）
   - 查看模板（带行列编号和颜色代码的网格）
   - 查看色号统计和用量
7. **下载图纸**：
   - **下载效果图**：96DPI预览图
   - **下载模板（96DPI）**：适合屏幕查看
   - **下载打印模板（600DPI）**：适合打印，清晰适配2.6mm/5mm拼豆基板

## 🎯 核心算法

### 硬像素化
使用区域平均采样算法，对每个目标像素计算源图像对应区域的平均颜色，保留更多细节。

### 感知加权颜色匹配
采用 ITU-R BT.601 标准，人眼对绿色更敏感，权重最高：
- 红色权重：0.299
- 绿色权重：0.587
- 蓝色权重：0.114

### 拼豆色号系统
支持多种色库：
- **24色基础色库**（新手基础24色）：适合简单图案
- **48色扩展色库**：平衡选择
- **72色完整色库**：最丰富选择（默认）
- **221色专业库**：专业全套色号
- **自定义色库**：支持JSON导入

色号编码使用字母+数字格式（如 A4, B5, C3, D7, E2, F5, G1, H2 等），符合实际拼豆色号标准。

### 模板生成系统
根据方案文档要求，实现了完整的模板生成功能：

- **行列编号**：顶部显示列编号（1-N），左侧显示行编号（1-N）
- **颜色代码显示**：网格内显示色号代码（如H2、H7），替代传统颜色块
- **底部色卡对照表**：自动生成横向排列的"颜色代码 + 色卡样例方块"对照表
- **统一背景色填充**：支持自定义背景色代码（默认H2），自动填充空白区域
- **高分辨率导出**：600DPI PNG格式，打印后清晰适配2.6mm/5mm拼豆基板
- **等宽字体**：使用Consolas等等宽字体，保证代码对齐

### 图片格式化系统
解决图片宽高比不匹配导致的转换效果不佳问题：

- **自动适配模式**：保持原图宽高比，自动缩放并居中放置（推荐）
- **裁剪模式**：保持宽高比，裁剪多余部分，支持5种裁剪位置（居中/顶部/底部/左侧/右侧）
- **填充模式**：保持原图完整，添加背景色填充到目标尺寸
- **拉伸模式**：强制拉伸到目标尺寸（可能造成变形，谨慎使用）
- **正方形模式**：自动裁剪为正方形，适合制作方形拼豆图案
- **实时预览**：显示原始尺寸和目标尺寸，方便调整

## 📁 项目结构

```
拼豆小工具/
├── src/
│   ├── components/
│   │   └── BeadConverter.vue    # 主组件
│   ├── core/
│   │   ├── bead-core.js         # 核心转换算法
│   │   ├── bead-libraries.js     # 色库定义
│   │   ├── template-generator.js # 模板生成器
│   │   ├── image-formatter.js   # 图片格式化工具
│   │   ├── ai-service.js        # AI服务（对接Banana.dev）
│   │   └── ai-generator.js      # AI生成器封装
│   ├── assets/
│   │   ├── main.css            # 主样式
│   │   └── ui-enhancements.css  # UI增强样式
│   ├── App.vue                  # 根组件
│   └── main.js                  # 入口文件
├── index.html                   # HTML模板
├── package.json                 # 项目配置
└── vite.config.js              # Vite配置
```

## 🎨 色库管理

### 内置色库
- **24色基础色库**：适合初学者
- **48色扩展色库**：平衡选择
- **72色完整色库**：最丰富选择（默认）

### 自定义色库
支持通过JSON文件导入自定义色库。JSON格式示例：

```json
{
  "name": "自定义色库名称",
  "colors": [
    {
      "code": "A4",
      "name": "亮黄",
      "hex": "#FFEB3B"
    }
  ]
}
```

在参数设置区域点击色库名称即可导入。

## 🤖 AI功能说明

### AI生成功能

项目集成了Banana.dev (Nano Banana pro)，使用Google API Key生成适合拼豆的图片。

#### 提示词模板

系统内置了优化的提示词模板，专门用于生成适合拼豆转换的图片：

- **拼豆风格模板**：生成圆形珠子排列的网格图案，清晰的颜色边界
- **像素艺术模板**：8-bit游戏风格，锐利边缘，鲜艳颜色
- **马赛克模板**：几何图案，清晰的色块分离

#### 使用Google API Key

1. 获取Google API Key（需要启用Imagen API）
2. 在AI生成模态框中输入API Key
3. API Key会保存在本地，不会上传到服务器

#### 生成流程

1. 用户输入描述 → 2. AI生成图片 → 3. 自动格式化 → 4. 转换为拼豆图

## 🔮 后续计划

根据技术报告，项目将分四阶段演进：

1. **功能补全**：
   - ✅ 模板生成（带行列编号和颜色代码）
   - ✅ 底部色卡对照表
   - ✅ 600DPI高分辨率导出
   - ✅ 统一背景色填充
   - ✅ AI图片生成
   - ✅ UI优化和交互增强
   - ⏳ PDF导出
   - ⏳ 边缘检测增强
   - ✅ 色号库管理
2. **AI智能化**：AI智能分割、用量预测、配色建议
3. **移动端适配**：原生App、性能优化
4. **商业闭环**：平台化、购买推荐

## 📝 许可证

MIT License

## 🙏 致谢

感谢所有拼豆爱好者的支持和建议！

